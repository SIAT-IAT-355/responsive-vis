<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta tag for responsive design -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <!-- D3.js library -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

    <style>
      /* Media queries for responsive header styling */
      @media screen and (min-width: 1200px) {
        header {
          color: black;
        }
      }

      @media screen and (min-width: 992px) and (max-width: 1199px) {
        header {
          color: steelblue;
        }
      }

      @media screen and (min-width: 768px) and (max-width: 991px) {
        header {
          color: darkred;
        }
      }

      @media screen and (min-width: 576px) and (max-width: 767px) {
        header {
          color: darkred;
          border-bottom: 1px solid darkred;
        }
      }

      @media screen and (max-width: 575px) {
        header {
          background-color: darkred;
          color: white;
        }
      }
    </style>
    <script>
      // Visualization data
      let data = [
        { name: "Alice", approval: 86 },
        { name: "Bobby", approval: 79 },
        { name: "Charlie", approval: 72 },
        { name: "Donna", approval: 67 },
        { name: "Emily", approval: 61 },
        { name: "Felix", approval: 54 },
        { name: "Gayle", approval: 46 },
        { name: "Helen", approval: 45 },
      ];

      let screen_width;
      let device_type;
      let params;

      function setParams() {
        // Determine the device type based on screen width
        (screen_width = window.innerWidth), device_type;
        if (screen_width >= 1200) device_type = "xl";
        else if (screen_width >= 992) device_type = "l";
        else if (screen_width >= 768) device_type = "m";
        else if (screen_width >= 576) device_type = "s";
        else device_type = "xs";

        // Parameters for different device types
        params = {
          xl: {
            width: 1140 - 24,
            height: 600,
            padding: 15,
            axis_area: 30,
            font_size: 16,
            bar_emphasis: "steelblue",
            text_emphasis: "white",
            dir: "v",
          },
          l: {
            width: 960 - 24,
            height: 520,
            padding: 15,
            axis_area: 30,
            font_size: 14,
            bar_emphasis: "steelblue",
            text_emphasis: "white",
            dir: "v",
          },
          m: {
            width: 720 - 24,
            height: 520,
            padding: 10,
            axis_area: 20,
            font_size: 14,
            bar_emphasis: "darkred",
            text_emphasis: "white",
            dir: "v",
          },
          s: {
            width: 540 - 24,
            height: 720,
            padding: 7,
            axis_area: 50,
            font_size: 14,
            bar_emphasis: "darkred",
            text_emphasis: "white",
            dir: "h",
          },
          xs: {
            width: screen_width - 24,
            height: 400,
            padding: 5,
            axis_area: 0,
            font_size: 14,
            bar_emphasis: "darkred",
            text_emphasis: "darkred",
            dir: "h",
          },
        }[device_type];
      }

      // Function to create the chart
      function make_chart() {
        // Clear existing chart
        document.querySelector("#chart-area").innerHTML = "";

        // Create SVG element
        const svg = d3.create("svg");

        svg
          .attr("viewBox", `0 0 ${params.width} ${params.height}`)
          .attr("width", params.width)
          .attr("height", params.height);

        // Define scales and dimensions based on orientation
        let scale_approval, bar_area_width, bar_area_height, bar_width;
        let scale_name;
        let approvals = data.map((d) => d.approval),
          names = data.map((d) => d.name);
        let max_approval = Math.max(...approvals);

        if (params.dir == "v") {
          bar_area_height =
            params.height - params.axis_area - params.padding * 2;
          bar_area_width = params.width - params.padding * 2;
          bar_width = bar_area_width / data.length;

          scale_approval = d3
            .scaleLinear()
            .domain([0, max_approval])
            .range([0, bar_area_height]);

          scale_name = d3
            .scaleOrdinal()
            .domain(names)
            .range(names.map((d, i) => (i + 0.5) * bar_width));
        } else {
          bar_area_width = params.width - params.axis_area - params.padding * 2;
          bar_area_height = params.height - params.padding * 2;
          bar_width = bar_area_height / data.length;

          scale_approval = d3
            .scaleLinear()
            .domain([0, max_approval])
            .range([0, bar_area_width]);

          scale_name = d3
            .scaleOrdinal()
            .domain(names)
            .range(names.map((d, i) => (i + 0.5) * bar_width));
        }

        // Define axis based on orientation
        let axis_name;
        if (params.dir == "v") {
          axis_name = d3.axisBottom(scale_name);
        } else {
          if (device_type === "s") {
            axis_name = d3.axisLeft(scale_name);
          } else if (device_type === "xs") {
            axis_name = d3.axisRight(scale_name);
            axis_name.tickSize(0);
          }
        }

        // Append axis to SVG
        let g_axis_name = svg.append("g").attr("id", "g-name-axis");
        g_axis_name.call(axis_name);
        g_axis_name.selectAll("path, line").attr("stroke-width", 0);
        g_axis_name.selectAll("text").attr("font-size", params.font_size);
        if (params.dir == "v") {
          g_axis_name.attr(
            "transform",
            `translate(${params.padding}, ${params.padding + bar_area_height})`
          );
        } else {
          if (device_type === "s") {
            g_axis_name.attr(
              "transform",
              `translate(${params.padding + params.axis_area}, ${
                params.padding
              })`
            );
          } else if (device_type === "xs") {
            axis_name.tickSize(0);
            g_axis_name.attr(
              "transform",
              `translate(${params.padding}, ${params.padding})`
            );
            g_axis_name
              .selectAll("text")
              .attr("transform", `translate(0 -${bar_width * 0.25})`);
          }
        }

        // Append bars and numbers to SVG
        let g_bars = svg.append("g").attr("id", "g-bars"),
          g_numbers = svg.append("g").attr("id", "g-numbers");

        if (params.dir == "v") {
          g_bars.attr(
            "transform",
            `translate(${params.padding}, ${params.padding})`
          );
          g_numbers.attr(
            "transform",
            `translate(${params.padding}, ${params.padding})`
          );
        } else {
          if (device_type === "s") {
            g_bars.attr(
              "transform",
              `translate(${params.padding + params.axis_area}, ${
                params.padding
              })`
            );
            g_numbers.attr(
              "transform",
              `translate(${params.padding + params.axis_area}, ${
                params.padding
              })`
            );
          } else if (device_type === "xs") {
            g_bars.attr(
              "transform",
              `translate(${params.padding}, ${params.padding})`
            );
            g_numbers.attr(
              "transform",
              `translate(${params.padding}, ${params.padding})`
            );
          }
        }

        // Create bars and numbers
        let bars = g_bars
            .selectAll("rect")
            .data(data)
            .join("rect")
            .attr("fill", (d) =>
              d.name === "Alice" ? params.bar_emphasis : "lightgray"
            ),
          numbers = g_numbers
            .selectAll("text")
            .data(data)
            .join("text")
            .text((d) => d.approval)
            .attr("font-size", params.font_size)
            .attr("fill", (d) =>
              d.name === "Alice" ? params.text_emphasis : "#676767"
            );

        // Set bar and number positions based on orientation
        if (params.dir == "v") {
          bars
            .attr("width", bar_width * 0.6)
            .attr("height", (d) => scale_approval(d.approval))
            .attr("x", (d) => scale_name(d.name))
            .attr("y", (d) => bar_area_height - scale_approval(d.approval))
            .attr("transform", `translate(-${bar_width * 0.3} 0)`);
          numbers
            .attr("x", (d) => scale_name(d.name))
            .attr(
              "y",
              (d) =>
                bar_area_height -
                scale_approval(d.approval) +
                params.font_size +
                params.padding
            )
            .attr("text-anchor", "middle");
        } else {
          bars
            .attr("height", bar_width * 0.5)
            .attr("width", (d) => scale_approval(d.approval))
            .attr("y", (d) => scale_name(d.name))
            .attr("x", 0);
          numbers
            .attr("x", (d) => scale_approval(d.approval) - params.padding)
            .attr("text-anchor", "end");
          if (device_type === "s") {
            bars.attr("transform", `translate(0 -${bar_width * 0.3})`);
            numbers.attr("y", (d) => scale_name(d.name) + params.font_size / 2);
          } else if (device_type === "xs") {
            bars.attr("transform", `translate(0 -${bar_width * 0.1})`);
            numbers.attr("y", (d) => scale_name(d.name) - bar_width * 0.2);
          }
        }

        // Append SVG to chart area
        document.querySelector("#chart-area").append(svg.node());
      }
    </script>
  </head>

  <body>
    <!-- Header section -->
    <header class="container py-2 mb-2">
      <h1>Responsive Visualization Example</h1>
    </header>
    <!-- Main content section -->
    <main class="container">
      <div class="row">
        <div class="col-12">
          <h2>The approval rate of candidates</h2>
          <p>
            A recent report shows that Alice is gaining the highest approval
            rate for this important position.
          </p>
          <!-- Chart area -->
          <div id="chart-area"></div>
        </div>
      </div>
    </main>
    <script>
      // Create the chart on page load
      setParams();
      make_chart();
      // Uncomment the line below to make the chart responsive to window resizing
      window.onresize = () => {
        setParams();
        make_chart();
      };
    </script>
  </body>
</html>
